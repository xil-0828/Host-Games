<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>å‚¬çœ ã‚¯ãƒªãƒƒã‚«ãƒ¼</title>
  <style>
    :root{
      --base-w:832; --base-h:1216;
      --bg:#0b0f14; --fg:#e6f1ff; --acc:#6fe3ff; --ring:rgba(111,227,255,.3);
    }
    *{box-sizing:border-box}
    html,body{height:100%; margin:0; font-family:sans-serif; background:#0b0f14; color:var(--fg); user-select:none;}
    .wrap{display:grid; place-items:center; min-height:100%; padding:12px;}
    .game{width:100%; max-width:min(100vw, 100vh*(var(--base-w)/var(--base-h))); aspect-ratio:calc(var(--base-w)/var(--base-h)); background:#111; border-radius:12px; overflow:hidden; position:relative;}
    .scene{position:relative; overflow:hidden; display:grid; place-items:center; background:#000; height:100%;}
    .scene img{max-width:100%; max-height:100%; object-fit:contain;}
    .ui{position:absolute; bottom:0; left:0; right:0; background:rgba(0,0,0,.6); padding:6px; font-weight:700; text-align:center;}
    .hit{position:absolute; inset:0; cursor:pointer; z-index:2;}
    .pulse{position:absolute; width:12vmin; height:12vmin; border-radius:50%; pointer-events:none; opacity:.55; mix-blend-mode:screen; transform:translate(-50%,-50%); background:radial-gradient(circle,var(--ring),rgba(111,227,255,0) 60%);}  
    .floatingText{position:absolute; color:#fff; font-size:14px; font-weight:700; pointer-events:none; text-shadow:0 0 4px #000;} 
    .critText{position:absolute; color:yellow; font-size:20px; font-weight:900; pointer-events:none; text-shadow:0 0 6px red, 0 0 12px yellow;} 
    .menuBtn{position:absolute; top:10px; right:10px; background:#333; color:#fff; border:none; padding:8px 12px; border-radius:8px; cursor:pointer; z-index:3;}
    .volumeBtn{position:absolute; top:10px; left:10px; background:#333; color:#fff; border:none; padding:8px 12px; border-radius:8px; cursor:pointer; z-index:3;}
    .upgrades{position:absolute; top:50px; right:10px; background:rgba(0,0,0,.8); padding:8px; border-radius:8px; font-size:14px; display:none; z-index:5; pointer-events:auto;}
    .upgrades button{display:block; width:100%; margin:4px 0; padding:6px; border:none; border-radius:6px; background:#222; color:#fff; cursor:pointer;}
    .clearBtn{position:absolute; bottom:10px; left:10px; background:#d33; color:#fff; border:none; padding:8px 12px; border-radius:8px; cursor:pointer; display:none; z-index:3;}
    .heart{position:absolute; font-size:80px; color:pink; text-shadow:0 0 8px #fff, 0 0 12px pink; cursor:pointer; user-select:none; pointer-events:auto;}
    .circle{position:absolute; width:200px; height:200px; border-radius:50%; cursor:pointer; user-select:none; display:flex; align-items:center; justify-content:center; background:radial-gradient(circle, rgba(0,255,255,0.3) 0%, rgba(0,255,255,0.05) 70%, transparent 100%); box-shadow:0 0 40px rgba(0,255,255,.6) inset, 0 0 25px rgba(0,255,255,.8);} 
    .circle .ring{
      position:absolute;
      border-radius:50%;
      border:2px solid cyan;
      box-shadow:0 0 12px cyan;
      animation:spin 8s linear infinite;
    }
    .circle .ring:nth-child(1){
      width:200px; height:200px;
    }
    .circle .ring:nth-child(2){
      width:160px; height:160px;
      animation-duration:12s;
      animation-direction:reverse;
    }
    .circle .ring:nth-child(3){
      width:120px; height:120px;
      animation-duration:16s;
    }
    @keyframes spin {
      0%{transform:rotate(0deg)}
      100%{transform:rotate(360deg)}
    }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="game" id="game">
      <div class="scene">
        <img id="pic" src="a1.jpg" alt="stage" draggable="false" />
        <div class="hit" id="hit"></div>
      </div>
      <div class="ui" id="ui">å‚¬çœ ãƒã‚¤ãƒ³ãƒˆ: 0</div>
      <button class="volumeBtn" id="volumeBtn">ğŸ”Š éŸ³é‡: 100%</button>
      <button class="menuBtn" id="menuBtn">ãƒ¬ãƒ™ãƒ«ã‚¢ãƒƒãƒ—</button>
      <button class="clearBtn" id="clearBtn">ã‚¯ãƒªã‚¢</button>
      <div class="upgrades" id="upgrades">
        <button data-up="click">ã‚¯ãƒªãƒƒã‚¯å¼·åŒ– Lv1 (ã‚³ã‚¹ãƒˆ: 50)</button>
        <button data-up="auto">ã‚ªãƒ¼ãƒˆãƒã‚¤ãƒ³ãƒˆ Lv0 (ã‚³ã‚¹ãƒˆ: 100)</button>
        <button data-up="speed">ã‚ªãƒ¼ãƒˆé€Ÿåº¦ Lv0 (ã‚³ã‚¹ãƒˆ: 500)</button>
        <button data-up="crit">ã‚ªãƒ¼ãƒˆã‚¯ãƒªãƒ†ã‚£ã‚«ãƒ« Lv0 (ã‚³ã‚¹ãƒˆ: 300)</button>
      </div>
    </div>
  </div>

  <script>
  (function(){
    let points=0;
    let stage=1;
    let clickPower=1;
    let autoPower=0;
    let clickLevel=1;
    let autoLevel=0;
    let speedLevel=0;
    let critLevel=0;
    let autoInterval=1000;
    let volume=1.0;
    const maxStage=10;

    const stageThresholds=[0,0,1000,2500,5000,10000,30000,50000,70000,100000,150000];

    const pic=document.getElementById('pic');
    const ui=document.getElementById('ui');
    const hit=document.getElementById('hit');
    const upgrades=document.getElementById('upgrades');
    const menuBtn=document.getElementById('menuBtn');
    const clearBtn=document.getElementById('clearBtn');
    const volumeBtn=document.getElementById('volumeBtn');

    // å†…éƒ¨çŠ¶æ…‹ï¼ˆè‡ªå‹•å‡¦ç†ç”¨ï¼‰
    let autoTimer=null;

    const clickSound = new Audio('a1.mp3');
    const clearSound = new Audio('a2.mp3');

    function update(){
      ui.textContent=`å‚¬çœ ãƒã‚¤ãƒ³ãƒˆ: ${points}`;
      let newStage=stage;
      for(let i=1;i<=maxStage;i++){
        if(points>=stageThresholds[i]) newStage=i;
      }
      if(newStage!==stage){
        stage=newStage;
        pic.src=`a${stage}.jpg`;
      }
      if(points>=150000){
        clearBtn.style.display='block';
      }
      upgrades.querySelector('[data-up="click"]').textContent = `ã‚¯ãƒªãƒƒã‚¯å¼·åŒ– Lv${clickLevel} (ã‚³ã‚¹ãƒˆ: ${50*clickLevel})`;
      upgrades.querySelector('[data-up="auto"]').textContent = `ã‚ªãƒ¼ãƒˆãƒã‚¤ãƒ³ãƒˆ Lv${autoLevel} (ã‚³ã‚¹ãƒˆ: ${100*(autoLevel+1)})`;
      upgrades.querySelector('[data-up="speed"]').textContent = `ã‚ªãƒ¼ãƒˆé€Ÿåº¦ Lv${speedLevel} (ã‚³ã‚¹ãƒˆ: ${500*(speedLevel+1)})`;
      upgrades.querySelector('[data-up="crit"]').textContent = `ã‚ªãƒ¼ãƒˆã‚¯ãƒªãƒ†ã‚£ã‚«ãƒ« Lv${critLevel} (ã‚³ã‚¹ãƒˆ: ${300*(critLevel+1)})`;
    }

    function addPulse(x,y){
      const d=document.createElement('div');
      d.className='pulse'; d.style.left=x+'px'; d.style.top=y+'px';
      d.animate([{transform:'translate(-50%,-50%) scale(0.6)',opacity:.7},{transform:'translate(-50%,-50%) scale(1.2)',opacity:0}],{duration:260,easing:'ease-out'});
      hit.appendChild(d); setTimeout(()=>d.remove(),280);
    }

    function showFloatingText(x,y,text,crit=false){
      const t=document.createElement('div');
      t.className= crit ? 'critText' : 'floatingText';
      t.textContent=text;
      t.style.left=x+'px';
      t.style.top=y+'px';
      hit.appendChild(t);
      t.animate([
        {transform:'translate(-50%,-50%) scale(1)',opacity:1},
        {transform:'translate(-50%,-50%) scale(1.5)',opacity:0}
      ],{duration:800,easing:'ease-out'});
      setTimeout(()=>t.remove(),800);
    }

    // â–¼ ãƒ©ãƒ³ãƒ€ãƒ ã‚¤ãƒ™ãƒ³ãƒˆï¼ˆâ™¡ ã¨ é­”æ³•é™£ï¼‰
    function spawnHeart(){
      const rect=hit.getBoundingClientRect();
      const heart=document.createElement('div');
      heart.className='heart';
      heart.textContent='â™¡';
      heart.style.left=Math.random()*rect.width+'px';
      heart.style.top=Math.random()*rect.height+'px';
      heart.style.position='absolute';
      hit.appendChild(heart);
      heart.addEventListener('click',()=>{
        points+=clickPower*50;
        showFloatingText(parseFloat(heart.style.left),parseFloat(heart.style.top),`+${clickPower*50}`);
        heart.remove();
        update();
      });
      setTimeout(()=>{ if(heart.parentNode) heart.remove(); },4000);
    }

    function spawnCircle(){
      const rect=hit.getBoundingClientRect();
      const circle=document.createElement('div');
      circle.className='circle';
      circle.style.left=Math.random()*(rect.width-200)+'px';
      circle.style.top=Math.random()*(rect.height-200)+'px';
      const ring1=document.createElement('div'); ring1.className='ring';
      const ring2=document.createElement('div'); ring2.className='ring';
      const ring3=document.createElement('div'); ring3.className='ring';
      circle.appendChild(ring1); circle.appendChild(ring2); circle.appendChild(ring3);
      hit.appendChild(circle);
      circle.addEventListener('click',()=>{
        // ã‚¯ãƒªãƒƒã‚¯ã—ã¦ã‚‚æ¶ˆãˆãšã€5ç§’é–“ã¯æ®‹ã‚‹
        points+=clickPower*5;
        showFloatingText(parseFloat(circle.style.left)+100,parseFloat(circle.style.top)+100,`+${clickPower*5}`);
        update();
      });
      setTimeout(()=>{ if(circle.parentNode) circle.remove(); },5000);
    }

    hit.addEventListener('pointerdown',e=>{
      e.preventDefault();
      points+=clickPower;
      clickSound.volume = volume;
      clickSound.currentTime = 0;
      clickSound.play();
      const rect=hit.getBoundingClientRect();
      const pt=e.touches?e.touches[0]:e;
      const x=pt.clientX-rect.left;
      const y=pt.clientY-rect.top;
      addPulse(x,y);
      showFloatingText(x,y,`+${clickPower}`);
      update();
    });

    menuBtn.addEventListener('click',()=>{
      upgrades.style.display = upgrades.style.display==='block' ? 'none' : 'block';
    });

    // â–¼ å¼·åŒ–ãƒœã‚¿ãƒ³ã®å‡¦ç†ï¼ˆæŠ¼ã›ãªã„å•é¡Œã®ä¿®æ­£ï¼šãƒªã‚¹ãƒŠãƒ¼ã‚’å¾©æ´»ï¼‰
    upgrades.addEventListener('click', (e)=>{
      const key = e.target?.dataset?.up;
      if(!key) return;
      if(key==='click'){
        const cost = 50*clickLevel;
        if(points>=cost){ points-=cost; clickLevel++; clickPower++; }
      } else if(key==='auto'){
        const cost = 100*(autoLevel+1);
        if(points>=cost){ points-=cost; autoLevel++; autoPower++; }
      } else if(key==='speed'){
        const cost = 500*(speedLevel+1);
        if(points>=cost){ points-=cost; speedLevel++; autoInterval=Math.max(200, autoInterval-100); restartAuto(); }
      } else if(key==='crit'){
        const cost = 300*(critLevel+1);
        if(points>=cost){ points-=cost; critLevel++; }
      }
      update();
    });

    volumeBtn.addEventListener('click',()=>{
      volume -= 0.25;
      if(volume < 0) volume = 1.0;
      clickSound.volume = volume;
      clearSound.volume = volume;
      volumeBtn.textContent = `ğŸ”Š éŸ³é‡: ${Math.round(volume*100)}%`;
    });

    clearBtn.addEventListener('click',()=>{
      // ã‚¯ãƒªã‚¢æ™‚ã®ã‚µã‚¦ãƒ³ãƒ‰ã¯é³´ã‚‰ã•ãªã„
      window.open('https://megane-ro.com/saiminkurixtuka-kuria3/','_blank');
    });

    // â–¼ è‡ªå‹•ç²å¾—é–¢é€£ï¼ˆã‚ªãƒ¼ãƒˆãƒã‚¤ãƒ³ãƒˆã€ã‚ªãƒ¼ãƒˆé€Ÿåº¦ã€ã‚ªãƒ¼ãƒˆã‚¯ãƒªãƒ†ã‚£ã‚«ãƒ«ï¼‰
    function restartAuto(){
      if(autoTimer) clearInterval(autoTimer);
      autoTimer = setInterval(autoGain, autoInterval);
    }

    function autoGain(){
      if(autoPower>0){
        let gained = autoPower;
        let isCrit = false;
        if(critLevel>0){
          const chance = critLevel/100; // Lv1=1%, Lv2=2% ...
          if(Math.random() < chance){
            gained = autoPower*50;
            isCrit = true;
          }
        }
        points += gained;
        const rect=hit.getBoundingClientRect();
        const x=Math.random()*rect.width;
        const y=Math.random()*rect.height;
        showFloatingText(x,y,`+${gained}`,isCrit);
        update();
      }
      // ãƒ©ãƒ³ãƒ€ãƒ å‡ºç¾ï¼ˆç¢ºç‡åˆ¶å¾¡ï¼‰
      const heartChance = points < 1000 ? 0.20 : 0.10; // 1000æœªæº€:20%, ä»¥é™:10%
      if(Math.random() < heartChance) spawnHeart();
      if(Math.random() < 0.02) spawnCircle(); // ãŸã¾ã«é­”æ³•é™£
    }

    restartAuto();

    update();
  })();
  </script>
</body>
</html>
